<!DOCTYPE html>

<template id="header">
    <header class="header">
        <div>
            <h1>The Blog of Andre Bačić</h1>
            <p>A blog about code and a project demonstrating my skills</p>
        </div>
    </header>
</template>

<template id="navbar-with-search">
    <input type="checkbox" id="navbar-toggle" class="navbar-toggle" />
    <label for="navbar-toggle" class="navbar-toggle-label">
        <span>
            <span id="line1"></span>
            <span id="line2"></span>
            <span id="line3"></span>
        </span>
    </label>
    <nav class="navbar">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a class="right" href="#footer" onclick="signUpAnimation()" id="sign-up-link">Sign Up</a>
        <a class="right" href="login.html" id="login-link">Login</a>
        <div style="float:right;">
            <label for="search-bar">Search:</label>
            <input id="search-bar" type="text" class="navbar-input" contenteditable="true" />
        </div>
        <script>
            const search_bar = document.querySelector("#search-bar")
            search_bar.addEventListener("keyup", function(event) {
                if (event.keyCode === 13) {
                    event.preventDefault();
                    window.location = `search.html?${search_bar.value}`
                }
            })
            //window.addEventListener("resize", windowOnResizeChangeColor)
        </script>
    </nav>
</template>
<template id="navbar-no-search">
    <input type="checkbox" id="navbar-toggle" class="navbar-toggle" />
    <label for="navbar-toggle" class="navbar-toggle-label">
        <span>
            <span id="line1"></span>
            <span id="line2"></span>
            <span id="line3"></span>
        </span>
    </label>
    <nav id="nav-no-search" class="navbar">
        <a href="index.html">Home</a>
        <a href="about.html">About</a>
        <a class="right" href="#footer" onclick="signUpAnimation()" id="sign-up-link">Sign Up</a>
        <a class="right" href="login.html" id="login-link">Login</a>
    </nav>
</template>

<template id="footer-not-logged-in">
    <footer id="footer" class="footer">
        <aside class="footer-signup-prompt">Please subscribe:</aside>
        <form class="footer-signup-form" id="register-form" action="javascript:void(0)">
            <input type="text" class="footer-signup-input" id="First_Name" placeholder="First Name" contenteditable="true" required />
            <input type="text" class="footer-signup-input" id="Last_Name" placeholder="Last Name" contenteditable="true" required />
            <input type="email" class="footer-signup-input" id="Email_address" placeholder="Email address" contenteditable="true" required />
            <input type="password" class="footer-signup-input" id="Password" placeholder="A New Password" contenteditable="true" required />
            <div style="display: inline-block;">
                <button type="button" class="blog-button" onclick="GetRegisterDataAndLoginAsync().then()" style="float:right;">Sign Up</button>
            </div>
        </form>
        <aside class="footer-copyright">
            <p>© <y id="year-display"></y> by Andre Bačić</p>
        </aside>
        <script>
            document.getElementById("year-display").textContent = (new Date()).getFullYear()
        </script>
        <script>
            async function GetRegisterDataAndLoginAsync() {
                let first_name_input = document.getElementById("First_Name")
                let last_name_input = document.getElementById("Last_Name")
                let email_address_input = document.getElementById("Email_address")
                let password_input = document.getElementById("Password")

                if (ValidateRegisterData(first_name_input.value,
                    last_name_input.value,
                    email_address_input.value,
                    password_input.value) === false) {
                    alert("Invalid sign up form input.")
                    return
                }

                let user = {
                    FirstName: first_name_input.value,
                    LastName: last_name_input.value,
                    EmailAddress: email_address_input.value,
                    Password: password_input.value,
                    DoesReceiveNotifications: true
                }
                let success = await CreateAccountAsync(user)
                let email_address = email_address_input.value
                let password = password_input.value
                first_name_input.value = "";
                last_name_input.value = "";
                email_address_input.value = "";
                password_input.value = "";

                if (success === true) {
                    await LoginAsync(email_address, password)
                    window.alert("Successfully signed up!")
                    window.location.reload()
                } else {
                    window.alert("There was a problem registering you.")
                }
            }
            function ValidateRegisterData(first_name, last_name, email_address, password) {
                if (first_name != '' &&
                    last_name != '' &&
                    isValidEmail(email_address) &&
                    password.match(passwordRegEx)) {
                    return true
                } else {
                    return false
                }
            }
        </script>
    </footer>
</template>
<template id="footer-user-logged-in">
    <footer id="footer" class="footer-logged-in footer">
        <h1 id="footer-header"></h1>
        <aside class="footer-copyright">
            <p>© <y id="year-display"></y> by Andre Bačić</p>
        </aside>
        <script>
            document.getElementById("year-display").textContent = (new Date()).getFullYear()
        </script>
        <script>
            let user = JSON.parse(localStorage.getItem('user'))
            document.getElementById("footer-header").textContent = `You are logged in as: ${user.name}`
        </script>
    </footer>
</template>